<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Infinite AI Jewelry Store</title>
    <link rel="stylesheet" href="styles.css">
    <script src="https://unpkg.com/lucide@latest"></script>
</head>
<body>
    <!-- Header -->
    <header class="header">
        <div class="container">
            <div class="header-content">
                <h1 class="logo">Infinite AI Jewelry Store</h1>
                <div class="header-right">
                    <div class="search-container">
                        <input type="text" placeholder="Search jewelry..." class="search-input">
                        <i data-lucide="search" class="search-icon"></i>
                    </div>
                    <button class="cart-button">
                        <i data-lucide="shopping-cart"></i>
                        <span class="cart-count">0</span>
                    </button>
                </div>
            </div>
        </div>
    </header>

    <!-- Main Content -->
    <main class="container main-content">
        <div id="home-content">
            <!-- Hero Section -->
            <div class="hero">
                <h1>Discover Timeless Beauty</h1>
                <p>Explore our exquisite collection of handcrafted jewelry pieces that blend traditional artistry with modern elegance.</p>
            </div>

            <!-- Categories Section -->
            <section class="categories-section">
                <h2>Our Collections</h2>
                <div class="category-grid" id="category-grid"></div>
            </section>

            <!-- Featured Items -->
            <section class="featured-section">
                <h2>Featured Pieces</h2>
                <div class="jewelry-grid" id="featured-items"></div>
            </section>
        </div>

        <div id="category-content" class="hidden">
            <button id="back-button" class="back-button">
                <i data-lucide="arrow-left"></i> Back to Categories
            </button>
            <h2 id="category-title"></h2>
            <div class="jewelry-grid" id="category-items"></div>
        </div>

        <!-- Improved Chat Widget with Modern UI -->
        <div id="rasa-chat-widget" class="fixed bottom-0 right-0 m-6 z-50">
            <!-- Chat Icon Button with Pulse Effect -->
            <button id="chat-toggle" class="w-16 h-16 rounded-full bg-gradient-to-r from-purple-600 to-indigo-600 text-white shadow-xl flex items-center justify-center transform transition-transform hover:scale-110 relative track-click">
                <span class="absolute animate-ping w-full h-full rounded-full bg-purple-400 opacity-50"></span>
                <i class="fas fa-comment-dots text-2xl relative z-10"></i>
            </button>
        
            <!-- Chat Container (Hidden by Default) -->
            <div id="chat-container" class="hidden rounded-2xl shadow-2xl overflow-hidden transition-all duration-300 transform" style="width: 380px; height: 600px; border: 1px solid rgba(123, 44, 191, 0.2);">
                <!-- Header with Brand -->
                <div class="bg-gradient-to-r from-purple-600 to-indigo-600 text-white p-4 flex justify-between items-center">
                    <div class="flex items-center">
                        <div class="w-10 h-10 rounded-full bg-white flex items-center justify-center mr-2">
                            <i class="fas fa-gem text-purple-600 text-lg"></i>
                        </div>
                        <div>
                            <h3 class="font-bold text-lg">Diya AI</h3>
                            <p class="text-xs text-purple-200">Jewelry Shopping Assistant</p>
                        </div>
                    </div>
                    <div class="flex space-x-2">
                        <button id="minimize-chat" class="hover:bg-purple-500 rounded-full w-8 h-8 flex items-center justify-center">
                            <i class="fas fa-minus"></i>
                        </button>
                        <button id="close-chat" class="hover:bg-purple-500 rounded-full w-8 h-8 flex items-center justify-center">
                            <i class="fas fa-times"></i>
                        </button>
                    </div>
                </div>
        
                <!-- Chat Messages Area with Custom Scrollbar -->
                <div id="chat-messages" class="p-6 overflow-y-auto bg-gray-50" style="height: 440px; scrollbar-width: thin; scrollbar-color: #9d4edd #f3f4f6;">
                    <!-- Messages will be added here -->
                </div>
        
                <!-- Input Area with Modern Look -->
                <div class="border-t border-gray-200 p-4 flex bg-white">
                    <input id="user-message" type="text" placeholder="Type a message..." 
                        class="flex-1 px-4 py-2 border border-gray-300 rounded-l-xl focus:outline-none focus:ring-2 focus:ring-purple-400 focus:border-transparent">
                    <button id="send-button" class="bg-gradient-to-r from-purple-600 to-indigo-600 text-white px-5 py-3 rounded-r-xl hover:from-purple-700 hover:to-indigo-700 transition-all duration-200 flex items-center justify-center">
                        <i class="fas fa-paper-plane"></i>
                    </button>
                </div>
        
                <!-- Typing Indicator (initially hidden) -->
                <div id="typing-indicator" class="hidden px-4 py-2 bg-gray-50 border-t border-gray-200">
                    <div class="flex items-center text-sm text-gray-500">
                        <div class="typing-animation mr-2">
                            <span></span>
                            <span></span>
                            <span></span>
                        </div>
                        Diya is typing...
                    </div>
                </div>
            </div>
        </div>
        
        <!-- Additional CSS for Animations and Effects -->
        <style>
            /* Custom Scrollbar */
            #chat-messages::-webkit-scrollbar {
                width: 6px;
            }
            #chat-messages::-webkit-scrollbar-track {
                background: #f3f4f6;
            }
            #chat-messages::-webkit-scrollbar-thumb {
                background-color: #9d4edd;
                border-radius: 20px;
            }
        
            /* Button Hover Effects */
            #send-button:hover {
                box-shadow: 0 4px 12px rgba(123, 44, 191, 0.2);
            }
            
            /* Typing Animation */
            .typing-animation {
                display: inline-flex;
                align-items: center;
                position: relative; /* Added to help with positioning */
                bottom: 15px; /* Move up by 5 pixels */
            }
            .typing-animation span {
                height: 8px;
                width: 8px;
                margin: 0 2px;
                background-color: #9d4edd;
                border-radius: 50%;
                display: inline-block;
                opacity: 0.4;
            }
            .typing-animation span:nth-child(1) {
                animation: pulse 1s infinite ease-in-out;
            }
            .typing-animation span:nth-child(2) {
                animation: pulse 1s infinite ease-in-out 0.2s;
            }
            .typing-animation span:nth-child(3) {
                animation: pulse 1s infinite ease-in-out 0.4s;
            }
            @keyframes pulse {
                0%, 100% { opacity: 0.4; }
                50% { opacity: 1; }
            }
        
            /* Chat Bubble Styles */
            .user-bubble {
                background: linear-gradient(135deg, #7b2cbf 0%, #9d4edd 100%);
                color: white;
                border-radius: 18px 18px 4px 18px;
                box-shadow: 0 4px 8px rgba(123, 44, 191, 0.15);
                max-width: 80%;
                padding: 12px 16px;
                margin-left: auto;
                word-break: break-word;
                animation: fadeIn 0.3s ease-out;
            }
            
            .bot-bubble {
                background: white;
                color: #333;
                border-radius: 18px 18px 18px 4px;
                box-shadow: 0 4px 8px rgba(0, 0, 0, 0.05);
                max-width: 80%;
                padding: 12px 16px;
                border: 1px solid rgba(123, 44, 191, 0.1);
                word-break: break-word;
                animation: fadeIn 0.3s ease-out;
            }
            
            @keyframes fadeIn {
                from { opacity: 0; transform: translateY(10px); }
                to { opacity: 1; transform: translateY(0); }
            }
            
            /* Button Styles */
            .chat-button {
                background-color: #f5f0ff;
                color: #7b2cbf;
                border: 1px solid #e0aaff;
                border-radius: 20px;
                padding: 8px 16px;
                font-size: 14px;
                margin: 4px;
                cursor: pointer;
                transition: all 0.2s ease;
                white-space: nowrap;
                overflow: hidden;
                text-overflow: ellipsis;
                max-width: 200px;
            }
            
            .chat-button:hover {
                background-color: #e0aaff;
                transform: translateY(-2px);
                box-shadow: 0 2px 4px rgba(123, 44, 191, 0.2);
            }
            
            /* Product Card Styles */
            .product-grid {
                display: grid;
                grid-template-columns: 1fr;
                gap: 16px;
                max-width: 100%;
                overflow-x: hidden;
            }
            
            .product-card {
                background: white;
                border-radius: 12px;
                overflow: hidden;
                border: 1px solid rgba(123, 44, 191, 0.1);
                box-shadow: 0 4px 6px rgba(0, 0, 0, 0.05);
                transition: all 0.3s ease;
            }
            
            .product-card:hover {
                transform: translateY(-5px);
                box-shadow: 0 8px 15px rgba(123, 44, 191, 0.15);
            }
            
            .product-image {
                height: 200px;
                overflow: hidden;
                display: flex;
                align-items: center;
                justify-content: center;
                background: #f8f9fa;
                border-bottom: 1px solid rgba(123, 44, 191, 0.05);
            }
            
            .product-image img {
                max-width: 100%;
                max-height: 100%;
                object-fit: contain;
            }
            
            .product-info {
                padding: 16px;
            }
            
            .product-title {
                font-weight: 600;
                font-size: 16px;
                color: #333;
                margin-bottom: 8px;
                overflow: hidden;
                text-overflow: ellipsis;
                display: -webkit-box;
                line-clamp: 2;
                -webkit-box-orient: vertical;
                min-height: 40px;
            }
            
            .product-description {
                font-size: 14px;
                color: #666;
                margin-bottom: 12px;
                overflow: hidden;
                text-overflow: ellipsis;
                display: -webkit-box;
                line-clamp: 2;
                -webkit-box-orient: vertical;
            }
            
            .product-price {
                font-weight: 600;
                font-size: 18px;
                color: #7b2cbf;
                display: flex;
                align-items: center;
                justify-content: center;  /* Changed from space-between to center */
            }
            
            .product-price .original {
                text-decoration: line-through;
                color: #999;
                font-size: 14px;
                margin-right: 8px;
            }
            
            /* Removed .add-to-cart-btn style completely since we're not using it anymore */
        </style>
        
        <script>
            document.addEventListener('DOMContentLoaded', function() {
                const chatToggle = document.getElementById('chat-toggle');
                const closeChat = document.getElementById('close-chat');
                const minimizeChat = document.getElementById('minimize-chat');
                const chatContainer = document.getElementById('chat-container');
                const chatMessages = document.getElementById('chat-messages');
                const userInput = document.getElementById('user-message');
                const sendButton = document.getElementById('send-button');
                const typingIndicator = document.getElementById('typing-indicator');
                
                // Replace with your actual Rasa endpoint
                const RASA_ENDPOINT = 'https://981d-13-71-3-97.ngrok-free.app';
                
                let sessionId = generateSessionId();
                let isMinimized = false;
                
                // Toggle chat window
                chatToggle.addEventListener('click', () => {
                    chatContainer.classList.toggle('hidden');
                    if (chatMessages.children.length === 0) {
                        addBotMessage("Hey there! 👋 Welcome to Infinite AI! Type 'Hello' to start your jewelry shopping experience!");
                    }
                });
                
                closeChat.addEventListener('click', () => {
                    chatContainer.classList.add('hidden');
                });
                
                minimizeChat.addEventListener('click', () => {
                    if (isMinimized) {
                        chatContainer.style.height = '580px';
                        isMinimized = false;
                    } else {
                        chatContainer.style.height = '60px';
                        isMinimized = true;
                    }
                });
                
                // Send message when button clicked
                sendButton.addEventListener('click', sendMessage);
                
                // Send message when Enter key pressed
                userInput.addEventListener('keypress', (e) => {
                    if (e.key === 'Enter') {
                        sendMessage();
                    }
                });
                
                function sendMessage() {
                    const message = userInput.value.trim();
                    if (!message) return;
                    
                    // Add user message to chat
                    addUserMessage(message);
                    userInput.value = '';
                    
                    // Show typing indicator
                    showTypingIndicator();
                    
                    // Send to Rasa
                    sendToRasa(message);
                }
                
                function showTypingIndicator() {
                    typingIndicator.classList.remove('hidden');
                    chatMessages.scrollTop = chatMessages.scrollHeight;
                }
                
                function hideTypingIndicator() {
                    typingIndicator.classList.add('hidden');
                }
                
                // Centralized function to send messages to Rasa
                function sendToRasa(message, isPayload = false) {
                    let requestBody;
                    if (isPayload) {
                        // For payloads from buttons
                        requestBody = {
                            sender: sessionId,
                            message: message
                        };
                    } else {
                        // For normal text messages
                        requestBody = {
                            sender: sessionId,
                            message: message
                        };
                    }
                    
                    fetch(`${RASA_ENDPOINT}/webhooks/rest/webhook`, {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json',
                        },
                        body: JSON.stringify(requestBody)
                    })
                    .then(response => response.json())
                    .then(data => {
                        // Hide typing indicator
                        hideTypingIndicator();
                        
                        // Process bot responses
                        if (data && data.length > 0) {
                            // Add slight delay between messages for better UX
                            let messageDelay = 0;
                            
                            data.forEach(response => {
                                setTimeout(() => {
                                    if (response.text) {
                                        addBotMessage(response.text);
                                    }
                                    
                                    // Handle buttons if present
                                    if (response.buttons && response.buttons.length > 0) {
                                        addButtons(response.buttons);
                                    }
                                }, messageDelay);
                                
                                messageDelay += 300; // 300ms delay between messages
                            });
                        } else {
                            addBotMessage("I'm sorry, I didn't get a response. Please try again.");
                        }
                    })
                    .catch(error => {
                        console.error('Error:', error);
                        hideTypingIndicator();
                        addBotMessage("Sorry, I'm having trouble connecting. Please try again later.");
                    });
                }
                
                function addUserMessage(text) {
                    const messageDiv = document.createElement('div');
                    messageDiv.className = 'flex justify-end mb-4';
                    
                    // Create avatar
                    const avatarDiv = document.createElement('div');
                    avatarDiv.className = 'w-8 h-8 rounded-full bg-purple-100 flex items-center justify-center ml-2 mt-1';
                    avatarDiv.innerHTML = '<span class="text-purple-600 font-medium text-sm">You</span>';
                    
                    // Create message bubble
                    const bubbleDiv = document.createElement('div');
                    bubbleDiv.className = 'user-bubble';
                    bubbleDiv.innerText = text;
                    
                    messageDiv.appendChild(bubbleDiv);
                    messageDiv.appendChild(avatarDiv);
                    
                    chatMessages.appendChild(messageDiv);
                    chatMessages.scrollTop = chatMessages.scrollHeight;
                }
                
                function addBotMessage(text) {
                    const messageDiv = document.createElement('div');
                    messageDiv.className = 'flex mb-4';
                    
                    // Create bot avatar
                    const avatarDiv = document.createElement('div');
                    avatarDiv.className = 'w-8 h-8 rounded-full bg-purple-600 flex items-center justify-center mr-2 mt-1';
                    avatarDiv.innerHTML = '<i class="fas fa-gem text-white text-xs"></i>';
                    
                    // Check if message contains HTML for product cards
                    if (text.includes('<div style=')) {
                        // Parse the message to separate text and HTML
                        const textBeforeHtml = text.split('<div style=')[0].trim();
                        
                        // Create a container for the message content
                        const contentContainer = document.createElement('div');
                        contentContainer.className = 'bot-bubble';
                        contentContainer.style.width = '300px'; // Fixed width for product cards
                        
                        // Add text heading if it exists
                        if (textBeforeHtml) {
                            const headingElement = document.createElement('div');
                            headingElement.className = 'mb-3 font-medium';
                            headingElement.textContent = textBeforeHtml;
                            contentContainer.appendChild(headingElement);
                        }
                        
                        // Extract the HTML for products and convert to our new format
                        const htmlPart = text.substring(text.indexOf('<div style='));
                        const tempDiv = document.createElement('div');
                        tempDiv.innerHTML = htmlPart;
                        
                        // Create our new product grid
                        const productGrid = document.createElement('div');
                        productGrid.className = 'product-grid';
                        
                        // Find all original product cards
                        const originalCards = tempDiv.querySelectorAll('div[style*="border"]');
                        originalCards.forEach(card => {
                            // Extract data from original card
                            const imgSrc = card.querySelector('img')?.src || "https://via.placeholder.com/150x150?text=No+Image";
                            const productName = card.querySelector('h3')?.textContent || "Product";
                            const productDesc = card.querySelector('p')?.textContent || "Description";
                            const priceElements = card.querySelectorAll('span');
                            
                            let basePrice = "";
                            let discountedPrice = "";
                            
                            if (priceElements.length > 1) {
                                basePrice = priceElements[0].textContent;
                                discountedPrice = priceElements[1].textContent;
                            } else if (priceElements.length === 1) {
                                basePrice = priceElements[0].textContent;
                            }
                            
                            // Create new card with our enhanced styling (removed Add to Cart button)
                            const newCard = document.createElement('div');
                            newCard.className = 'product-card';
                            newCard.innerHTML = `
                                <div class="product-image">
                                    <img src="${imgSrc}" alt="${productName}" onerror="this.src='https://via.placeholder.com/150x150?text=No+Image';">
                                </div>
                                <div class="product-info">
                                    <h3 class="product-title">${productName}</h3>
                                    <p class="product-description">${productDesc}</p>
                                    <div class="mt-3 text-center">
                                        <div class="product-price">
                                            ${discountedPrice ? `<span class="original">${basePrice}</span><span>${discountedPrice}</span>` : `<span>${basePrice}</span>`}
                                        </div>
                                    </div>
                                </div>
                            `;
                            
                            // No more Add to Cart button or event listener
                            
                            productGrid.appendChild(newCard);
                        });
                        
                        contentContainer.appendChild(productGrid);
                        
                        messageDiv.appendChild(avatarDiv);
                        messageDiv.appendChild(contentContainer);
                    } else {
                        // Regular text message
                        const bubbleDiv = document.createElement('div');
                        bubbleDiv.className = 'bot-bubble';
                        
                        // Check for URLs and make them clickable
                        const urlRegex = /(https?:\/\/[^\s]+)/g;
                        const textWithLinks = text.replace(urlRegex, url => `<a href="${url}" target="_blank" class="text-purple-600 underline">${url}</a>`);
                        
                        bubbleDiv.innerHTML = textWithLinks;
                        
                        messageDiv.appendChild(avatarDiv);
                        messageDiv.appendChild(bubbleDiv);
                    }
                    
                    chatMessages.appendChild(messageDiv);
                    chatMessages.scrollTop = chatMessages.scrollHeight;
                }
                
                function addButtons(buttons) {
                    const buttonsDiv = document.createElement('div');
                    buttonsDiv.className = 'flex flex-wrap gap-2 mb-4 ml-10';
                    
                    buttons.forEach(button => {
                        const buttonEl = document.createElement('button');
                        buttonEl.className = 'chat-button';
                        buttonEl.textContent = button.title;
                        buttonEl.dataset.payload = button.payload; // Store payload as data attribute
                        
                        buttonEl.addEventListener('click', (event) => {
                            // Get the button's payload from the data attribute
                            const payload = event.currentTarget.dataset.payload;
                            
                            // Show user's selection
                            addUserMessage(button.title);
                            
                            // Show typing indicator
                            showTypingIndicator();
                            
                            // Send payload to Rasa
                            sendToRasa(payload, true);
                        });
                        
                        buttonsDiv.appendChild(buttonEl);
                    });
                    
                    chatMessages.appendChild(buttonsDiv);
                    chatMessages.scrollTop = chatMessages.scrollHeight;
                }
                
                // Kept the addToCart function for backward compatibility but removed its usage
                function addToCart(productIdx) {
                    // Create a payload to send to Rasa
                    const payload = `/add_to_cart{"product_idx": "${productIdx}"}`;
                    
                    // Add a user message indicating the action
                    addUserMessage(`Adding to cart`);
                    
                    // Show typing indicator
                    showTypingIndicator();
                    
                    // Send the payload to Rasa
                    sendToRasa(payload, true);
                }
                
                // Remove the document-level addToCart event listener since we don't have Add buttons anymore
                // But keeping the function for backward compatibility in case it's used elsewhere
                
                function generateSessionId() {
                    return 'user_' + Math.random().toString(36).substring(2, 15);
                }
            });
        </script>    
    </main>

    <!-- Footer -->
    <footer class="footer">
        <div class="container">
            <div class="footer-grid">
                <div class="footer-section">
                    <h3>About Us</h3>
                    <p>Infinite AI Jewelry Store brings you the finest collection of traditional and modern jewelry pieces.</p>
                </div>
                <div class="footer-section">
                    <h3>Quick Links</h3>
                    <ul>
                        <li><a href="#">Home</a></li>
                        <li><a href="#">Shop</a></li>
                        <li><a href="#">About</a></li>
                        <li><a href="#">Contact</a></li>
                    </ul>
                </div>
                <div class="footer-section">
                    <h3>Contact</h3>
                    <ul>
                        <li>123 Jewelry Lane</li>
                        <li>New York, NY 10001</li>
                        <li>Phone: (555) 123-4567</li>
                        <li>Email: info@infiniteaijewelry.com</li>
                    </ul>
                </div>
                <div class="footer-section">
                    <h3>Follow Us</h3>
                    <div class="social-icons">
                        <i data-lucide="facebook"></i>
                        <i data-lucide="instagram"></i>
                        <i data-lucide="twitter"></i>
                    </div>
                </div>
            </div>
            <div class="footer-bottom">
                <p>&copy; 2024 Infinite AI Jewelry Store. All rights reserved.</p>
            </div>
        </div>
    </footer>

    <script src="data.js"></script>
    <script src="app.js"></script>
</body>
</html>
